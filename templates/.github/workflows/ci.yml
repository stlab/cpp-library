# Auto-generated from cpp-library (https://github.com/stlab/cpp-library)
# Do not edit this file directly - it will be overwritten when templates are regenerated

name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  release:
    types: [published]

jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        compiler: [gcc, clang, msvc]
        exclude:
          - os: ubuntu-latest
            compiler: msvc
          - os: macos-latest
            compiler: msvc
          - os: macos-latest
            compiler: gcc
          - os: windows-latest
            compiler: gcc
          - os: windows-latest
            compiler: clang

    runs-on: ${{ matrix.os }}

    steps:
    - uses: actions/checkout@v4

    - name: Configure CMake
      run: cmake --preset=test

    - name: Build
      run: cmake --build --preset=test

    - name: Test
      run: ctest --preset=test

  clang-tidy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4

    - name: Setup Ninja
      uses: ashutoshvarma/setup-ninja@master

    - name: Setup Clang
      uses: egor-tensin/setup-clang@v1
      with:
        version: latest

    - name: Install clang-tidy
      run: sudo apt-get update && sudo apt-get install -y clang-tidy

    - name: Configure CMake with clang-tidy
      run: cmake --preset=clang-tidy

    - name: Build with clang-tidy
      run: cmake --build --preset=clang-tidy

    - name: Run tests with clang-tidy
      run: ctest --preset=clang-tidy

  docs:
    runs-on: ubuntu-latest
    if: github.event_name == 'release' && github.event.action == 'published'
    permissions:
      id-token: write
      pages: write
      contents: read
    
    steps:
    - uses: actions/checkout@v5
      
    - name: Install Doxygen
      uses: ssciwr/doxygen-install@v1
    
    - name: Configure CMake
      run: cmake --preset=docs
    
    - name: Build Documentation
      run: cmake --build --preset=docs
    
    - name: Setup Pages
      uses: actions/configure-pages@v5

    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: build/docs/html

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
